"use strict";window.Solidarity=_.extend(window.Solidarity,{Models:{},Collections:{},Views:{},Routers:{},routers:{},init:function(){if(console.log("Stories of Solidarity"),this.mainContent=Solidarity.RegionManager,this.routers.auth=new Solidarity.Routers.Auth({}),this.routers.pages=new Solidarity.Routers.Pages({}),this.routers.stories=new Solidarity.Routers.Stories({}),this.shareBar=new Solidarity.Views.StoryPost({}),this.searchBar=new Solidarity.Views.SearchBar({}),!Backbone.history.start()){var a="404 for /"+window.location.hash+" redirecting to /#about";console.error(a),Backbone.history.navigate("about",{trigger:!0})}$.ajaxSetup({headers:{"X-Requested-With":"XMLHttpRequest"}}),$('a[href^="sms:"]').click(function(){return window.innerWidth>768?!1:void 0}),$(".navbar-collapse li.button a").on("click",function(){$(".navbar-collapse").hasClass("in")&&$(".navbar-collapse").collapse("hide")})},log:function(a,b){Solidarity.DEBUG&&(b?console.log(a,b):console.log(a))},error:function(a,b){Solidarity.DEBUG?(console.error(b),console.error(a)):Raven.captureException(a)}}),window.urlParam=function(a){var b=window.location.href.match(/^[^#]+#([^?]*)\??(.*)/),c=(b[1],b[2]),d=c.split(a+"=")[1];return void 0!==d?decodeURIComponent(d.split("&")[0]):null},$(document).ready(function(){Solidarity.init(),Solidarity.DEBUG||Raven.config(window.Solidarity.ravenConfig).install(),window.location.hash&&"#splash"!==window.location.hash&&(Solidarity.log("starting at"+window.location.hash),$("nav.navbar-default").removeClass("hidden"),$("footer.footer").removeClass("hidden"))}),this.JST=this.JST||{},this.JST["app/templates/about.html"]=function(a){var b="";_.escape;return b+='<div class="about page">\n	<section class="gray">\n	    <h1>A social media tool that helps workers in low wage, precarious jobs to build new forms of solidarity and mutual aid.</h2>\n	</section>\n\n	<section class="yellow">\n		<div class="row">\n		    <h2>How does it work?</h2>\n		    <div class="content one-third-col">\n		    	<ul class="text">\n			    	<li><h3>Post a story via the web, mobile app, or text messaging.</h3></li>\n			    	<li><h3>It will appear on the map, to share with others.</h3></li>\n			    	<li><h3>Totally anonymous.</h3></li>\n			    </ul>\n			    <div class="image">\n			    	<img src="images/15db276c.howitworks.png">\n			    </div>\n		    </div>\n		</div>		\n	</section>\n\n	<section class="orange">\n		<div class="row">\n		    <h2>Project Background</h2>\n		    <div class="content two-col">\n		        <div class="text">\n			        <p>The Stories of Solidarity project arose from a “hack-a-thon” group formed for a conference organized by UC Davis Professors Chris Benner, Jesse Drew and Glenda Drew entitled “Social Media, Insecure Work and New Solidarities” held at the UCLA downtown labor center in the Fall of 2012.</p>\n			        <p>The “hack-a-thon” group came together to create a new social media platform beneficial to those organizing sectors of workers that suffer from low wages, poor healthcare, immigration problems and other aspects of much of the new economy. The original hack-a-thon team was comprised of students and faculty from Design, Computer Science, History, Community Development, Technocultural Studies, and Digital Humanities from both UC Davis and UC Los Angeles.</p>\n					<p>The project recognizes that social media has become a powerful means for connecting people and supporting social movement organizing. At the same time, rapid technological change, globalization and volatile competitive conditions have contributed to growing insecurity in work, in which the workplace is less frequently a site of long-term stability and collective conceptions of work have been eroded as a basis for solidarity. By building the Stories of Solidarity project, the developers seek to apply skill and talent to help solve an important social ill that plagues millions of workers in the US.</p>\n				</div>\n		    </div>\n	    </div>\n	</section>\n\n	<section class="gray">\n		<div class="row">\n			<h2>2013-2014 Team</h2>\n			<div class="content three-col">\n				<ul>\n					<li><em>UCDavis</em></li>\n					<li>Glenda Drew</li>\n					<li>Jesse Drew</li>\n					<li>Kat Fukui</li>\n					<li>John Haffner</li>\n					<li>Vivian Ho</li>\n					<li>Jack Leng</li>\n					<li>Joyce Lue</li>\n					<li>Tristan Schoening</li>\n					<li>Liz Shigetoshi</li>\n					<li>Ashish Subedy</li>\n				</ul>\n\n				<ul>\n					<li><em>UCLA</em></li>\n					<li>Leslie Bloomfield</li>\n					<li>Anthony Bushong</li>\n					<li>Sophia Campos</li>\n					<li>Amy Hawkins</li>\n					<li>David Kim</li>\n					<li>Joanna Lo</li>\n					<li>Celso Mireles</li>\n					<li>Miriram Posner</li>\n					<li>Monit Tiyagi</li>\n				</ul>\n\n				<ul>\n					<li><em>Special thanks</em></li>\n					<li>Chris Benner</li>\n					<li>Tobias Higbie</li>\n					<li>Goetz Wolff</li>\n				</ul>\n			</div>\n		</div>\n\n		<div class="row">	\n			<h2>2014-2015 Team</h2>\n			<div class="content three-col">\n				<ul>\n					<li><em>UCDavis</em></li>\n					<li>Glenda Drew</li>\n					<li>Jesse Drew</li>\n					<li>John Haffner</li>\n					<li>Michellle Huey</li>\n					<li>Emily Isaac</li>\n					<li>Jack Leng</li>\n					<li>Tiffany Monica Louie</li>\n					<li>Elizabeth Pizano</li>\n				</ul>\n\n				<ul>\n					<li><em>UCBerkeley</em></li>\n					<li>Ken Jacobs</li>\n					<li>&nbsp;</li>\n					<li><em>UCMerced</em></li>\n					<li>Robin Delugan</li>\n					<li>Lidia Pavon</li>\n				</ul>\n\n				<ul>\n					<li><em>SpacedogXYZ</em></li>\n					<li>Josh Levinger</li>\n				</ul>\n			</div>\n		</div>\n	</section>\n\n	<section class="yellow">\n		<div class="row">\n			<h2>Supporters</h2>\n			<div class="content one-col">\n				<ul>\n					<li>67 Sueños</li>\n					<li>Center for Digital Storytelling</li>\n					<li>Food Chain Workers Alliance</li>\n					<li>Los Angeles Alliance for a New Economy Story-based Strategy</li>\n				</ul>\n			</div>\n		</div>\n\n		<div class="row">\n			<h2>Sponsors</h2>\n			<div class="content one-col">\n				<ul>\n					<li>AFL-CIO</li>\n					<li>CCMAD (California Center for Media Arts and Democracy)</li>\n					<li>CITRIS (Center for Information Technology Research in the Interest of Society)</li>\n					<li>OUR Walmart</li>\n					<li>UCHRI (University of California Humanities Research Institute)</li>\n					<li>UCIRA (University of California Institute for Research in the Arts)</li>\n					<li>ViDi (Visualization and Interface Design Innovation)</li>\n				</ul>\n			</div>\n		</div>\n	</section>\n</div>'},this.JST["app/templates/authLogin.html"]=function(a){var b,c="";_.escape;return c+='<div class="auth login container-fluid">\n\n<div class="alert alert-info alert-dismissable">\n    <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>\n    Never registered? <a href="#auth/register">Create a new user</a><br />\n    Forgot your password? <a href="#auth/password/reset">Reset it</a>\n</div>\n\n<h2>Log In User</h2>\n\n<form class="form-horizontal" id="login" action="'+(null==(b=Solidarity.apiRoot)?"":b)+'auth/login/" method="POST">\n    <div class="form-group">\n        <label for="username" class="col-sm-2 control-label">Username:</label>\n        <input name="username" class="col-sm-4" />\n        <span class="help-block col-sm-4"></span>\n    </div>\n\n    <div class="form-group">\n        <label for="password" class="col-sm-2 control-label">Password:</label>\n        <input name="password" class="col-sm-4" type="password"/>\n        <span class="help-block col-sm-4"></span>\n    </div>\n\n    <div class="form-group">\n        <button class="btn btn-primary col-sm-offset-2" type="submit">\n            <span class="glyphicon glyphicon-log-in"></span> Go\n        </button>\n    </div>\n</form>\n\n</div>'},this.JST["app/templates/authPasswordChange.html"]=function(a){var b,c="";_.escape;return c+='<div class="auth passwordChange container-fluid">\n\n<h2>Change Password</h2>\n\n<form class="form-horizontal" id="passwordChange" action="'+(null==(b=Solidarity.apiRoot)?"":b)+'auth/password/change/" method="POST">\n\n    <div class="form-group">\n        <label for="new_password1" class="col-sm-2 control-label">New Password:</label>\n        <input name="new_password1" class="col-sm-4" type="password"/>\n        <span class="help-block"></span>\n    </div>\n\n    <div class="form-group">\n        <label for="new_password2" class="col-sm-2 control-label">Confirm New Password:</label>\n        <input name="new_password2" class="col-sm-4" type="password"/>\n        <span class="help-block"></span>\n    </div>\n\n    <div class="form-group">\n        <button class="btn btn-primary col-sm-offset-2" type="submit">\n            <span class="glyphicon glyphicon-log-in"></span> Go\n        </button>\n    </div>\n</form>\n\n</div>'},this.JST["app/templates/authPasswordReset.html"]=function(a){var b,c="";_.escape;return c+='<div class="auth passwordReset container-fluid">\n\n<h2>Reset Password</h2>\n\n<form class="form-horizontal" id="passwordReset" action="'+(null==(b=Solidarity.apiRoot)?"":b)+'auth/password/reset/" method="POST">\n\n    <div class="form-group">\n        <label for="email" class="col-sm-2 control-label">Registered Email:</label>\n        <input name="email" class="col-sm-4" type="email"/>\n        <span class="help-block col-sm-4"></span>\n    </div>\n\n    <div class="form-group">\n        <button class="btn btn-primary col-sm-offset-2" type="submit">\n            <span class="glyphicon glyphicon-log-in"></span> Go\n        </button>\n    </div>\n</form>\n\n</div>'},this.JST["app/templates/authPasswordResetConfirm.html"]=function(a){var b,c="";_.escape;return c+='<div class="auth passwordChange container-fluid">\n\n<h2>Set New Password</h2>\n\n<form class="form-horizontal" id="passwordResetConfirm" action="'+(null==(b=Solidarity.apiRoot)?"":b)+'auth/password/reset/confirm/" method="POST">\n\n    <div class="form-group">\n        <label for="new_password1" class="col-sm-2 control-label">New Password:</label>\n        <input name="new_password1" class="col-sm-4" type="password"/>\n        <span class="help-block col-sm-4"></span>\n    </div>\n\n    <div class="form-group">\n        <label for="new_password2" class="col-sm-2 control-label">Confirm New Password:</label>\n        <input name="new_password2" class="col-sm-4" type="password"/>\n        <span class="help-block col-sm-4"></span>\n    </div>\n\n    <div class="form-group">\n        <button class="btn btn-primary col-sm-offset-2" type="submit">\n            <span class="glyphicon glyphicon-log-in"></span> Go\n        </button>\n    </div>\n</form>\n\n</div>'},this.JST["app/templates/authRegister.html"]=function(a){var b,c="";_.escape;return c+='<div class="auth register container-fluid">\n\n<div class="alert alert-info alert-dismissable">\n    <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>\n    Already registered? <a href="#auth/login">Login</a>\n</div>\n\n<h2>Register New User</h2>\n\n<form class="form-horizontal" id="register" action="'+(null==(b=Solidarity.apiRoot)?"":b)+'auth/registration/" method="POST">\n    <div class="form-group">\n        <label for="username" class="col-sm-2 control-label">Username:</label>\n        <input name="username" class="col-sm-4" />\n        <span class="help-block col-sm-4"></span>\n    </div>\n\n    <div class="form-group">\n        <label for="password1" class="col-sm-2 control-label">Password:</label>\n        <input name="password1" class="col-sm-4" type="password"/>\n        <span class="help-block col-sm-4"></span>\n    </div>\n\n    <div class="form-group">\n        <label for="password2" class="col-sm-2 control-label">Confirm Password:</label>\n        <input name="password2" class="col-sm-4" type="password"/>\n        <span class="help-block col-sm-4"></span>\n    </div>\n\n    <div class="form-group">\n        <button class="btn btn-primary col-sm-offset-2" type="submit">\n            <span class="glyphicon glyphicon-log-in"></span> Go\n        </button>\n    </div>\n</form>\n\n</div>'},this.JST["app/templates/authUserDetails.html"]=function(a){var b,c="";_.escape;return c+='<div class="auth user container-fluid">\n\n<h2>User Update</h2>\n\n<form class="form-horizontal" id="userDetails" action="'+(null==(b=Solidarity.apiRoot)?"":b)+'auth/user/" method="POST">\n    <div class="form-group">\n        <label for="email" class="col-sm-2 control-label">Email:</label>\n        <input name="email" class="col-sm-4" />\n        <span class="help-block col-sm-4"></span>\n    </div>\n\n    <div class="form-group">\n        <label for="first_name" class="col-sm-2 control-label">First Name:</label>\n        <input name="first_name" class="col-sm-4" />\n        <span class="help-block col-sm-4"></span>\n    </div>\n\n    <div class="form-group">\n        <label for="last_name" class="col-sm-2 control-label">Last Name:</label>\n        <input name="last_name" class="col-sm-4" />\n        <span class="help-block col-sm-4"></span>\n    </div>\n\n    <div class="form-group">\n        <label for="phone" class="col-sm-2 control-label">SMS Number:</label>\n        <input name="phone" class="col-sm-4" />\n        <span class="help-block col-sm-4"></span>\n    </div>\n\n    <div class="form-group">\n        <button class="btn btn-primary col-sm-offset-2" type="submit">\n            <span class="glyphicon glyphicon-log-in"></span> Go\n        </button>\n    </div>\n</form>\n\n</div>'},this.JST["app/templates/copyright.html"]=function(a){var b="";_.escape;return b+='<div class="copyright page">\n	<section class="light-gray">\n		<div class="row">\n			<h2>Copyright</h2>\n\n			<div class="content two-col">\n				<div class="text">\n					<p>Submitted content is provided under the Creative Commons license, which gives you the ability to share and adapt the material under the same license. Any re-use of the content must follow the following conditions:</p>\n					<ul>\n					    <li>&ndash; You must attribute the content to StoriesOfSolidarity.org. On the web, this means a link. For use offline, please use the text “Content (cc) StoriesOfSolidarity.org”</li>\n					    <li>&ndash; You cannot use our content for commercial purposes.</li>\n					    <li>&ndash; If you use our content, you must share what you create with it under the same license. This is called share-alike, and it\'s the basis of the free culture movement.</li>\n					    <li>&ndash; You may not redistribute photographs or reuse the StoriesOfSolidarity name and design without specific permission.</li>\n					</ul>\n\n					<p>You can find the full legal text of the license at <a href="http://creativecommons.org/licenses/by-nc-sa/3.0/legalcode">creativecommons.org/licenses/by-nc-sa/3.0/legalcode</a></p>\n				</div>\n			</div>\n		</div>\n	</section>\n\n	<section class="light-gray">\n		<div class="row">\n			<h2>Open Source</h2>\n			<div class="content two-col">\n				<div class="text">\n					<p>The code that powers this website, database and mobile application are open source, and available on <a href="https://github.com/storiesofsolidarity">GitHub</a> under the <a href="http://opensource.org/licenses/GPL-3.0"></a>GPL license. We welcome new feature ideas, issue reports, and pull requests.</p>\n\n					<p>Specific functionality is provided by the <a href="http://d3js.org">D3</a> visualization library, <a href="https://www.djangoproject.com">Django</a> <a href="http://www.django-rest-framework.org">REST-Framework</a>, the <a href="https://www.twilio.com"></a>Twilio telephony service, and the <a href="www.mapzen.com"></a>Mapzen</a> geocoder. </p>\n				</div>\n			</div>\n		</div>\n	</section>\n</div>'},this.JST["app/templates/formError.html"]=function(a){var b,c="";_.escape;return c+='<div class="alert alert-warning" role="alert">\n  <span class="glyphicon glyphicon-exclamation-sign" aria-hidden="true"></span>\n  <span class="sr-only">Error:</span>\n  '+(null==(b=a.non_field_errors)?"":b)+"\n</div>"},this.JST["app/templates/learn.html"]=function(a){var b="";_.escape;return b+='<div class="videoWrapper">\n	<iframe src="https://player.vimeo.com/video/75254033?autoplay=1&title=0&byline=0&portrait=0" width="500" height="281" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe>\n</div>'},this.JST["app/templates/privacy.html"]=function(a){var b="";_.escape;return b+='<div class="privacy page">\n	<section class="light-gray">\n		<div class="row">\n			<h2>Privacy Policy</h2>\n\n			<div class="content half-col">\n				<div class="text">\n					<p>StoriesOfSolidarity takes seriously workers need for anonymity when speaking out, and our system is designed to protect your information to the best of our ability.</p>\n				</div>\n			</div>\n		</div>\n	</section>\n\n	<section class="light-gray">\n		<div class="row">\n			<h2>Required Disclosure</h2>\n\n			<div class="content two-col">\n				<div class="text">\n					<p>We may disclose personally identifiable information about you to third parties in limited circumstances, including: (1) with your consent; or (2) when we have a good faith belief it is required by law, such as pursuant to a subpoena or other judicial or administrative order.</p>\n\n					<p>If we are required by law to disclose the information that you have submitted, we will attempt to provide you with prior notice (unless we are prohibited or it would be futile) that a request for your information has been made in order to give you an opportunity to object to the disclosure. We will attempt to provide this notice by email, if you have given us an email address, or by postal mail if you have entered a postal address. If you do not challenge the disclosure request, we may be legally required to turn over your information.</p>\n\n					<p>If you feel uncomfortable with revealing your real identity when sharing a story, please create an account using a pseudonym and sign up with a new email address that you do not share with other services.</p>\n				</div>\n			</div>\n		</div>\n	</section>\n\n</div>'},this.JST["app/templates/splash.html"]=function(a){var b,c="";_.escape;return c+='<div class="splash">\n    <div class="center">\n    <ul class="statement" >\n        <li id="zh">\n            <img src="'+(null==(b=Solidarity.siteRoot+"images/logo/f7f6e070.logo_zh_small.png")?"":b)+'" alt="我们的故事" />\n            <h1>与他人分享您的工作的故事。</h1>\n            <h2>改变从这里开始。</h2>\n            <button class="btn enter" href="#map" data-lang="ZH">输入</button>\n        </li>\n\n        <li id="en" style="display: none;">\n            <img src="'+(null==(b=Solidarity.siteRoot+"images/logo/606e007a.logo_en_small.png")?"":b)+'" alt="Stories of Solidarity" />\n            <div class="inner">\n                <h1>Share your work story with others.</h1>\n                <h2>Change starts here.</h2>\n            </div>\n            <button class="btn enter" href="#map" data-lang="EN">ENTER</button>\n        </li>\n\n        <li id="es" style="display: none;">\n            <img src="'+(null==(b=Solidarity.siteRoot+"images/logo/50dc3e90.logo_es_small.png")?"":b)+'" alt="Historias de Solidaridad" />\n            <h1>Comparte su historia del trabajo con otros.</h1>\n            <h2>Camboio empeiza aqui.</h2>\n            <button class="btn enter" href="#map" data-lang="ES">ENTRAR</button>\n        </li>\n\n        <li id="tl" style="display: none;">\n            <img src="'+(null==(b=Solidarity.siteRoot+"images/logo/e250b567.logo_tl_small.png")?"":b)+'" alt="Kuwento ng Solidarity" />\n            <h1>Ibahagi ang iyong kuwento trabaho sa iba.</h1>\n            <h2>Baguhin ang nagsisimula dito.</h2>\n            <button class="btn enter" href="#map" data-lang="TL">PUMASOK</button>\n        </li>\n    </ul>\n\n    <ul class="languages">\n        <li><button class="btn lang active" href="#map" data-lang="zh">\n            <span style="margin-left:-1px;">中国</span>\n        </button></li>\n        <li><button class="btn lang" href="#map" data-lang="en"><span>ENG</span></button></li>\n        <li><button class="btn lang" href="#map" data-lang="es"><span>ESP</span></button></li>\n        <li><button class="btn lang" href="#map" data-lang="tl"><span>TAG</span></button></li>\n    </ul>\n\n    </div>\n</div>'},this.JST["app/templates/story.html"]=function(a){var b="",c=_.escape;Array.prototype.join;return b+='<div class="storyRead">\n    <button href="#close" onclick="history.go(-1);return false;" class="btn close gray" >\n        <span>&times;</span> Close\n    </button>\n\n    <div class="content ',b+=c(a.content&&a.content.length>160?"two-col":"one-col-right"),b+=" ",a.photo&&(b+=c("has-photo")),b+='">\n        <h1>',b+=a.author&&a.author.anonymous!==!0?'\n                <!-- <a href="#read/author/'+c(a.author.user.id)+'">'+c(a.author.user.first_name)+" "+c(a.author.user.last_name)+"</a> -->\n                "+c(a.author.user.first_name)+" "+c(a.author.user.last_name)+"\n            ":"\n                Anonymous\n            ",b+="\n            <!--\n            ",a.author&&a.author.occupation&&(b+="  "+c(a.author.occupation)+" "),b+="\n            ",a.author&&a.author.employer&&(b+=" at "+c(a.author.employer)+" "),b+="\n            -->\n            ",a.location&&a.location.city&&a.location.state&&(b+="\n                from "+c(a.location.city)+", "+c(a.location.state)+"\n            "),b+=' wrote:\n        </h1>\n\n        <div class="text">\n            '+c(a.content)+"\n        </div>\n\n        ",a.photo&&(b+='\n        <div class="photo">\n            <img src="'+c(a.photo)+'">\n        </div>\n        '),b+="\n    </div>\n</div>"},this.JST["app/templates/storyList.html"]=function(a){var b,c="";_.escape,Array.prototype.join;return c+='<div class="storyList">\n	<button href="#close" onclick="history.go(-1);return false;" class="btn close gray" >\n        <span>&times;</span> Close\n    </button>\n\n\n	<div class="stories">\n		<ul class="filters">\n			',a.location&&(c+='\n			<li><span id="storyCount">'+(null==(b=a.story_count)?"":b)+"</span> stor"+(null==(b=1==a.story_count?"y":"ies")?"":b)+" from "+(null==(b=a.location)?"":b)+"</li>\n			"),c+='\n		</ul>\n\n		<div class="grid">\n	    <!-- story items added here -->\n		</div>\n	</div>\n</div>'},this.JST["app/templates/storyListBreak.html"]=function(a){var b="",c=_.escape;return b+='<div class="item break">\n    <h3 id="page-'+c(a.num)+'"> Page '+c(a.num)+" </h3>\n</div>"},this.JST["app/templates/storyListItem.html"]=function(a){var b,c="",d=_.escape;Array.prototype.join;return c+='<div class="item story" id="story-'+(null==(b=a.id)?"":b)+'">\n    <div class="body">\n        ',a.content.length>160?(c+="\n            ",c+=" "==a.content.charAt(159)?"\n                "+d(a.content.slice(0,159))+"...\n            ":"\n                "+d(a.content.slice(0,160))+"...\n            ",c+="\n        "):c+="\n            "+d(a.content)+"\n        ",c+='\n        \n    </div>\n    <div class="meta">\n        <span class="permalink">\n            <a class="permalink" href="#read/story/'+(null==(b=a.id)?"":b)+'">more</a>\n        </span>\n        <span class="date">\n            '+(null==(b=moment(a.created_at).format("M/D/YYYY - h:mma"))?"":b)+"\n        </span>\n    </div>\n</div>"},this.JST["app/templates/storyListNoResults.html"]=function(a){var b="";_.escape;return b+='<div class="item break" style="">\n    <h3>None Yet</h3>\n</div>'},this.JST["app/templates/storyMap.html"]=function(a){var b="";_.escape;return b+='<div class="storyMap clearfix">\n	<div id="zoom">\n		<div class="btn zoom in">+</div>\n		<input type="range" min="0" max="8" />\n		<div class="btn zoom out">-</div>\n	</div>\n	<div id="map"></div>\n</div>'},this.JST["app/templates/storyMapTooltip.html"]=function(a){var b,c="";_.escape;return c+='<div class="header"><a href="#view/'+(null==(b=a.url)?"":b)+'">View Results</a></div>\n<div class="count">\n	'+(null==(b=a.story_count)?"":b)+" stor"+(null==(b=1==a.story_count?"y":"ies")?"":b)+" from "+(null==(b=a.name)?"":b)+"\n</div>"},this.JST["app/templates/storyPost.html"]=function(a){var b,c="";_.escape;return c+='<span class="icon icon-write"></span>\n<div class="storyPost">\n    <form class="form" action="'+(null==(b=Solidarity.apiRoot)?"":b)+'story/" id="storyPost" method="POST">\n        <div class="hidden">\n            <input name="robotCheck" />\n        </div>\n\n        <div class="box white">\n            <div class="form-group first">\n                <label for="content" class="hidden">Story: <span class="required">*</span></label>\n                <textarea id="storyContent" rows="12" class="open" name="content"\n                placeholder="SHARE YOUR STORY" value="" required="required"></textarea>\n                <div class="help-block hidden"></div>\n            </div>\n\n            <div class="form-group row break">\n                <h4>Optional Information</h4>\n            </div>\n\n            <div class="form-group row">\n                <label for="name" class="hidden">Name:</label>\n                <input id="name" name="name"\n                placeholder="NAME" value="" type="text">\n            </div>\n\n            <div class="form-group row">\n                <label for="occupation" class="hidden">Occupation:</label>\n                <input id="occupation" name="occupation"\n                placeholder="OCCUPATION"  value="" type="text">\n            </div>\n\n            <div class="form-group row">\n                <label for="employer" class="hidden">Employer:</label>\n                <input id="employer" name="employer"\n                placeholder="EMPLOYER" value="" type="text">\n            </div>\n\n            <div class="form-group row last">\n                <label for="location" class="hidden">Location:</label>\n                <div class="input-group" id="location">\n                    <button type="button" class="btn btn-sm btn-white line-height-1" id="geolocate"><span class="icon icon-locate"></span></button>\n\n                    <input id="city" name="location.city" value="" type="text" placeholder="CITY">\n                    <input id="county" name="location.county" type="hidden">\n                    <select id="state" class="selectpicker show-tick show-menu-arrow" data-size="auto" name="location.state">\n                        <option value="">STATE</option>\n                        <option value="AL">Alabama</option>\n                        <option value="AK">Alaska</option>\n                        <option value="AS">American Samoa</option>\n                        <option value="AZ">Arizona</option>\n                        <option value="AR">Arkansas</option>\n                        <option value="CA">California</option>\n                        <option value="CO">Colorado</option>\n                        <option value="CT">Connecticut</option>\n                        <option value="DE">Delaware</option>\n                        <option value="DC">District of Columbia</option>\n                        <option value="FL">Florida</option>\n                        <option value="GA">Georgia</option>\n                        <option value="GU">Guam</option>\n                        <option value="HI">Hawaii</option>\n                        <option value="ID">Idaho</option>\n                        <option value="IL">Illinois</option>\n                        <option value="IN">Indiana</option>\n                        <option value="IA">Iowa</option>\n                        <option value="KS">Kansas</option>\n                        <option value="KY">Kentucky</option>\n                        <option value="LA">Louisiana</option>\n                        <option value="ME">Maine</option>\n                        <option value="MD">Maryland</option>\n                        <option value="MA">Massachusetts</option>\n                        <option value="MI">Michigan</option>\n                        <option value="MN">Minnesota</option>\n                        <option value="MS">Mississippi</option>\n                        <option value="MO">Missouri</option>\n                        <option value="MT">Montana</option>\n                        <option value="NE">Nebraska</option>\n                        <option value="NV">Nevada</option>\n                        <option value="NH">New Hampshire</option>\n                        <option value="NJ">New Jersey</option>\n                        <option value="NM">New Mexico</option>\n                        <option value="NY">New York</option>\n                        <option value="NC">North Carolina</option>\n                        <option value="ND">North Dakota</option>\n                        <option value="MP">Northern Mariana Islands</option>\n                        <option value="OH">Ohio</option>\n                        <option value="OK">Oklahoma</option>\n                        <option value="OR">Oregon</option>\n                        <option value="PA">Pennsylvania</option>\n                        <option value="PR">Puerto Rico</option>\n                        <option value="RI">Rhode Island</option>\n                        <option value="SC">South Carolina</option>\n                        <option value="SD">South Dakota</option>\n                        <option value="TN">Tennessee</option>\n                        <option value="TX">Texas</option>\n                        <option value="UT">Utah</option>\n                        <option value="VT">Vermont</option>\n                        <option value="VI">Virgin Islands</option>\n                        <option value="VA">Virginia</option>\n                        <option value="WA">Washington</option>\n                        <option value="WV">West Virginia</option>\n                        <option value="WI">Wisconsin</option>\n                        <option value="WY">Wyoming</option>\n                    </select>\n                </div>\n            </div>\n        </div>\n\n        <div class="form-group break push-down">\n            <h4>Or text your story to 855.464.7671</h4>\n        </div>\n\n        <div class="form-group buttons last clearfix">\n            <div class="input-group left">\n                <button class="btn btn-white" id="cancel">\n                    <span class="icon icon-close"></span>\n                    CANCEL\n                </button>\n            </div>\n\n            <div class="input-group right">\n                <label for="photo" class="hidden">Photo:</label>\n                <span class="btn btn-default btn-file">\n                    <span class="icon icon-camera"></span>\n                    <input type="file" name="photo" accept="image/*" />\n                </span>\n\n                <button type="submit" class="btn btn-success" id="submit">\n                    <span class="icon icon-check"></span>\n                    SHARE\n                </button>\n            </div>\n        </div>\n    </form>\n</div>'},this.JST["app/templates/storySearch.html"]=function(a){var b="",c=_.escape;Array.prototype.join;if(b+='<input name="search" placeholder="Search"\n',a.search&&(b+=' value="'+c(a.search)+'" '),b+='\n/>\n\n<span class="icon icon-search"></span>\n',a.search&&(b+='\n<span class="icon close">&times;</span>\n'),b+="\n\n",a.count>0){b+='\n<div class="searchResults">\n	';for(i in a.results){var d=a.results[i];b+='\n		<div class="result"><a href="#read/story/'+c(d.id)+'">\n			',d.content.length>160?(b+="\n            ",b+=" "==d.content.charAt(159)?"\n                "+c(d.content.slice(0,159))+"...\n            ":"\n                "+c(d.content.slice(0,160))+"...\n            ",b+="\n        "):b+="\n            "+c(d.content)+"\n        ",b+="\n		</div>\n	"}b+="\n</div>\n"}else b+="\n	",a.search&&(b+='\n	<div class="searchResults">\n		<div class="result none">No results</div>\n	</div>\n	'),b+="\n";return b},this.JST["app/templates/storyThanks.html"]=function(a){var b,c="";_.escape;return c+='<div class="storyThanks">\n	<div class="input-group right">\n		<div class="btn btn-default close gray">\n			<span class="icon">&times;</span>\n			CLOSE\n		</div>\n	</div>\n\n	<div class="content">\n		<h1>Thank you for submitting your story!</h1>\n\n		<h2>View your story at the following link:</h2>\n		<div class="copyLink">'+(null==(b=a.link)?"":b)+'</div>\n	</div>\n\n	<!--<div class="input-group right">\n		<div class="btn btn-default">\n			LOGIN\n		</div>\n\n		<div class="btn btn-default">\n		    CREATE ACCOUNT\n		</div>\n	</div>-->\n\n</div>';
},Solidarity.Models=Solidarity.Models||{},function(){Solidarity.Models.BaseModel=Backbone.Model.extend({initialize:function(){},defaults:{},validate:function(a,b){},parse:function(a,b){return a},url:function(){var a=this.get("links"),b=a&&a.self;return b||(b=Backbone.Model.prototype.url.call(this)),b},sync:function(a,b,c){var d=_.isFunction(b.url)?b.url():b.url;return d+="/"===d.charAt(d.length-1)?"":"/",c=_.extend(c,{url:d}),Backbone.sync(a,b,c)}})}(),Solidarity.Models=Solidarity.Models||{},function(){Solidarity.Models.Story=Solidarity.Models.BaseModel.extend({urlRoot:Solidarity.apiRoot+"story/"})}(),Solidarity.Models=Solidarity.Models||{},function(){Solidarity.Models.Author=Solidarity.Models.BaseModel.extend({url:Solidarity.apiRoot+"author/",idAttributemodel:"username"})}(),Solidarity.Models=Solidarity.Models||{},function(){Solidarity.Models.State=Solidarity.Models.BaseModel.extend({urlRoot:Solidarity.apiRoot+"state/"}),Solidarity.Models.County=Solidarity.Models.BaseModel.extend({urlRoot:Solidarity.apiRoot+"county/",parse:function(a,b){return a.name&&(a.name=a.name.replace(" County","").replace(" Parish","")),a}}),Solidarity.Models.Zipcode=Solidarity.Models.BaseModel.extend({urlRoot:Solidarity.apiRoot+"zipcode/"})}(),Solidarity.Collections=Solidarity.Collections||{},function(){Solidarity.Collections.BaseCollection=Backbone.PageableCollection.extend({resultsField:"results",totalRecordsField:"count",nextField:"next",previousField:"previous",queryParams:{totalPages:null,totalRecords:null,pageSize:null},state:{pageSize:50},parseRecords:function(a,b){return a&&_.has(a,this.resultsField)&&_.isArray(a[this.resultsField])?a[this.resultsField]:void Backbone.PageableCollection.prototype.parseRecords.apply(this,arguments)},parseState:function(a,b,c,d){return{totalRecords:a[this.totalRecordsField]}},parseLinks:function(a,b){return{prev:a[this.previousField],next:a[this.nextField],first:null}}})}(),Solidarity.Collections=Solidarity.Collections||{},function(){Solidarity.Collections.Stories=Solidarity.Collections.BaseCollection.extend({model:Solidarity.Models.Story,url:Solidarity.apiRoot+"story/"})}(),Solidarity.Collections=Solidarity.Collections||{},function(){Solidarity.Collections.Authors=Solidarity.Collections.BaseCollection.extend({model:Solidarity.Models.Author})}(),Solidarity.Collections=Solidarity.Collections||{},function(){Solidarity.Collections.States=Solidarity.Collections.BaseCollection.extend({model:Solidarity.Models.State,url:Solidarity.apiRoot+"state/"}),Solidarity.Collections.Counties=Solidarity.Collections.BaseCollection.extend({model:Solidarity.Models.County,url:Solidarity.apiRoot+"county/",state:{pageSize:100}}),Solidarity.Collections.Zipcodes=Solidarity.Collections.BaseCollection.extend({model:Solidarity.Models.Zipcode,url:Solidarity.apiRoot+"zipcode/"})}(),Solidarity.RegionManager=function(a,b){var c,d=!0,e="#mainRegion",f="ul.navbar-nav",g={},h=function(a){a&&(a.close&&a.close(),a.tip&&a.tip.destroy())},i=function(a){d=!1;var c=function(){var b=a.render(a.options);b&&b.$el&&(b.$el.appendTo(e),b.delegateEvents())};b.when(c()).done(function(){a.onShow&&a.onShow()})};return g.show=function(a,d,e){h(c),c=a,i(c),d?(b(f+" li.button.active").removeClass("active"),b(f+" li.button a[href="+d+"]").parent("li.button").addClass("active")):b(f+" li.button.active").removeClass("active"),e?(b(".footer ul.links a.active").removeClass("active"),b(".footer ul.links a[href="+e+"]").addClass("active")):b(".footer ul.links a.active").removeClass("active")},g.currentView=function(){return c},g.freshView=function(){return d},g.showOverlay=function(a){var c=b('<div id="overlay"></div>');b("body").append(c),void 0!==a&&b("#overlay").addClass("active")},g.hideOverlay=function(){b("body > #overlay").removeClass("active").remove()},g}(Backbone,jQuery),Solidarity.Views=Solidarity.Views||{},function(){Solidarity.Views.BaseView=Backbone.View.extend({assign:function(a,b){a.setElement(this.$(b)).render()},initialize:function(){Solidarity.log("initalize "+this.cid)},render:function(){return this.$el.html(this.template()),this},close:function(){this.beforeClose&&this.beforeClose(),this.remove(),this.onClose&&this.onClose(),this.trigger("close"),this.unbind()}}),Solidarity.Views.FormView=Solidarity.Views.BaseView.extend({events:{submit:"submit","keyup .has-error":"clearFieldErrors"},templateError:JST["app/templates/formError.html"],render:function(){return this.$el.html(this.template()),this},onShow:function(){this.$form=$(this.form)},clearFieldErrors:function(a){var b=this,c=$(a.target).attr("name");$(b.form+' label[for="'+c+'"]').removeClass("has-error"),$(b.form+' [name="'+c+'"]').removeClass("has-error"),$(b.form+' [name="'+c+'"] + .help-block').html("")},clearAlerts:function(){$(this.form+" .alert").remove()},submit:function(a){a.preventDefault();var b=this;Solidarity.log("submit "+b.$form[0].id);var c=new FormData,d=b.$form.find('input[type!="file"], select, textarea');_.each(d,function(a){var b=$(a);b.val()&&c.append(b.attr("name"),b.val())});var e=b.$form.find('input[type="file"]');return _.each(e,function(a){var b=$(a);c.append(b.attr("name"),a.files[0])}),console.log(c),$.ajax({type:b.$form.attr("method"),url:b.$form.attr("action"),data:c,processData:!1,contentType:!1,success:function(a){return $(b.form+" .alert").remove(),void 0!==b.onSuccess?b.onSuccess(a):!0},error:function(a){b.clearAlerts(),b.$form.addClass("error");var c=a.responseJSON;return void 0===c?(b.$form.append(b.templateError({non_field_errors:a.statusText})),Solidarity.log(a.responseText),!0):(Solidarity.log(c),_.map(c,function(a,c){$(b.form+' label[for="'+c+'"]').addClass("has-error"),$(b.form+' [name="'+c+'"]').addClass("has-error"),$(b.form+' [name="'+c+'"] + .help-block').html(a).removeClass("hidden")}),void 0!==c.non_field_errors&&b.$form.append(b.templateError(c)),!1)}}),!1},redirect:function(){window.urlParam("redirect")?Backbone.history.navigate(window.urlParam("success"),{trigger:!0}):Backbone.history.navigate("",{trigger:!0})}})}(),Solidarity.Views=Solidarity.Views||{},function(){Solidarity.Views.Story=Solidarity.Views.BaseView.extend({template:JST["app/templates/story.html"],el:"#content",events:{},initialize:function(){this.listenTo(this.model,"add",this.render),this.model.fetch({success:$.proxy(this.render,this)})},render:function(){return this.model&&this.model.attributes&&this.$el.html(this.template(this.model.toJSON())),this}})}(),Solidarity.Views=Solidarity.Views||{},function(){Solidarity.Views.StoryList=Solidarity.Views.BaseView.extend({optionsDefaults:{},template:JST["app/templates/storyList.html"],templateItem:JST["app/templates/storyListItem.html"],templateBreak:JST["app/templates/storyListBreak.html"],templateNoResults:JST["app/templates/storyListNoResults.html"],el:"#content",storyEl:".grid",hasLoaded:!1,initialize:function(a){this.options=_.extend(this.optionsDefaults,a),this.render(this.options),this.collection=new Solidarity.Collections.Stories({mode:"infinite"}),this.listenTo(this.collection,"add",this.addStory),this.filterData(),this.getFirstPage(),$("body").on("scroll",_.bind(this.watchScroll,this)),$(window).on("resize",_.debounce(_.bind(function(){this.setGridWidth(),this.layout(!0)},this),100))},close:function(){$("body").off("scroll",this.watchScroll),$(window).off("resize",this.setGridWidth)},filterData:function(){},getFirstPage:function(){var a=this;a.isLoading=!0,this.collection.getFirstPage({success:function(b){0===b.length?$(a.templateNoResults({})).appendTo(a.storyEl):$("span#storyCount").text(b.state.totalRecords),window.location.href.indexOf("?story=")>0&&a.scrollTo(Solidarity.urlParam("story")),a.layout(a.hasLoaded),a.setGridWidth(),a.isLoading=!1,a.hasLoaded=!0}})},addStory:function(a){a.attributes.content&&$(this.templateItem(a.attributes)).appendTo(this.storyEl)},render:function(a){return void 0===a&&(a=this.options),this.$el.html(this.template(a)),this},setGridWidth:function(){$(".stories").css("width","auto");var a=$(".grid .item").outerWidth(),b=0;$(".grid .item").length&&(b=parseInt($(".grid .item").css("margin-right").substr(0,2)));var c=$(".grid").width(),d=Math.floor(c/(a+b));d=Math.max(d,1),$(".stories").css("width",d*(a+b))},layout:function(a){var b=100,c=0;window.innerWidth<768&&(a=!0),a&&(b=0,c=0),$(this.storyEl).stalactite({duration:b,delay:c,easing:"swing",cssPrefix:".stalactite",cssPrep:!0,fluid:!1,loader:"<img />"})},onShow:function(){_.each(this.collection.models,_.bind(this.addStory,this)),this.layout(this.hasLoaded),this.setGridWidth()},scrollTo:function(a){var b=$("#story-"+a);b.length>0&&$(this.storyEl).scrollTop(b.offset().top)},watchScroll:function(a){var b=100,c=$(this.storyEl);if(0!==c.length){var d=c.offset().top+c.height()-window.innerHeight,e=this;if(!this.isLoading&&b>d){if(!this.collection.hasNextPage())return;e.isLoading=!0,$(this.templateBreak({num:this.collection.state.currentPage})).appendTo(this.storyEl),this.collection.getNextPage({success:function(){e.layout(!0),e.isLoading=!1,e.hasLoaded=!0}})}var f=-1*c.offset().top;!this.isLoading&&b>f&&this.layout(!0)}}}),Solidarity.Views.StoryListLocation=Solidarity.Views.StoryList.extend({filterData:function(){var a;this.options&&this.options.location&&(a=this.options.location.match(/^\d+$/)?"zipcode":"county"),this.collection.queryParams=_.extend(this.collection.queryParams,{state_name:this.options.state_name,limit:this.options.limit}),this.collection.queryParams[a]=this.options.location},render:function(a){var b,c;return b=a&&a.location?a.location.match(/^\d+$/)?"zip":"county":"state",a&&a.location&&a.state_name?c=a.location+", "+a.state_name:a&&a.state_name&&(c=a.state_name),this.$el.html(this.template({filtered:!0,location:c,geography:b})),this}})}(),Solidarity.Views=Solidarity.Views||{},function(){Solidarity.Views.StoryMap=Solidarity.Views.BaseView.extend({template:JST["app/templates/storyMap.html"],templateTip:JST["app/templates/storyMapTooltip.html"],el:"#content",events:{},dataCache:{us:void 0,counties:{},zips:{}},initialize:function(){this.states=new Solidarity.Collections.States({}),this.counties=new Solidarity.Collections.Counties({}),this.zipcodes=new Solidarity.Collections.Zipcodes({}),this.colorList=["#E4E4E4","#F3EB99","#FAC85F","#F9A946","#EC913D"]},onShow:function(){var a=this;this.drawMap(),this.states.fetch({success:function(b){a.renderStoryCollection("USA",b,"g.country path.feature")}})},drawMap:function(){function a(a,b){void 0===b&&(b=.9);var c=v.bounds(a),d=c[1][0]-c[0][0],e=c[1][1]-c[0][1],f=(c[0][0]+c[1][0])/2,g=(c[0][1]+c[1][1])/2,h=b/Math.max(d/q,e/r),i=[q/2-h*f,r/2-h*g];t.svg.transition().duration(750).call(w.translate(i).scale(h).event)}function b(){s.style("fill",t.colorUnselected).classed("feature",!0).classed("background",!1).classed("active",!1),s=d3.select(null),d3.selectAll("g.state").remove(),t.svg.transition().duration(750).call(w.translate([0,0]).scale(1).event),t.renderStoryCollection("USA",t.states,"g.country path.feature")}function c(){var a=1;d3.select(this).classed("out")&&(a=-1);var b=w.scale(),c=w.scaleExtent(),d=c[0],e=c[1],f=w.scale()+a;f>e&&(f=e),d>f&&(f=d);var g=w.translate(),h=[q/2,r/2];w.translate([h[0]+(g[0]-h[0])/b*f,h[1]+(g[1]-h[1])/b*f]).scale(f).event(t.svg)}function d(){w.scale(d3.select(this).property("value")).event(t.svg)}function e(){var a=d3.event,b=Math.min(0,Math.max(a.translate[0],q-q*a.scale)),c=Math.min(0,Math.max(a.translate[1],r-r*a.scale));w.translate([b,c]),$("#zoom input").val(Math.log2(a.scale)),t.map.style("stroke-width",1.5/a.scale+"px"),d3.event.scale>1?t.map.attr("transform","translate("+[b,c]+")scale("+a.scale+")"):(t.map.transition().duration(75).attr("transform","translate([0,0])scale(1)"),w.translate([0,0]).scale(1))}function f(){d3.event.defaultPrevented&&d3.event.stopPropagation()}function g(a){var b=a.properties;return b.story_count=b.story_count||0,b.name=b.name||a.id,"state"===b.type&&(b.state_name=b.name,b.url=b.state_name),"county"===b.type&&(b.state_name=d3.select("g.state").attr("id"),b.url=b.state_name+"/"+b.name),"zip"===b.type&&(b.state_name=d3.select("g.state").attr("id"),b.url=b.state_name+"/"+b.name),t.templateTip(b)}function h(a){switch(a.properties.name){case"Puerto Rico":case"Maine":return"w";default:return"e"}}function i(a){switch(a.properties.name){case"Alaska":return[0,-40];case"California":return[0,-40];case"Minnesota":return[0,-25];case"New York":return[0,-25];case"Idaho":return[0,-20];case"Louisiana":return[0,-20];case"Maine":return[0,0];case"Puerto Rico":return[0,-10];default:return[0,-10]}}function j(c){if(Solidarity.log("clickState",c.properties.name),s.node()===this)return b();s.style("fill",t.colorUnselected).classed("feature",!0).classed("background",!1).classed("active",!1),s=d3.select(this).classed("active",!0),d3.selectAll("path.background").style("fill",t.colorBackground),d3.selectAll("g.state").remove();var d=.9;"25"===c.id&&(d=.75),"36"===c.id&&(d=.6),"09"===c.id&&(d=.5),"44"===c.id&&(d=.3),"11"===c.id&&(d=.2),a(c,d);var e=c.properties.name.replace(" ","_");queue().defer(d3.json,Solidarity.dataRoot+"geography/counties/"+e+".topo.json").await(n),queue().defer(d3.json,Solidarity.dataRoot+"geography/zcta/"+e+".topo.json").await(o)}function k(b){Solidarity.log("clickCounty",b.properties.name),d3.selectAll(b).style("fill","transparent"),a(b),p(b)}function l(a){Solidarity.log("clickZip",a.id)}function m(a,b){if(a)return Solidarity.error(a,"error in drawStates"),!1;var c=t.map.append("g").attr("class","country").attr("id","US"),d=topojson.feature(b,b.objects.states).features;_.each(d,function(a){a.properties.type="state"}),c.append("path").datum(topojson.merge(b,b.objects.states.geometries)).attr("class","background").attr("d",v),c.selectAll("path").attr("class","states").data(d).enter().append("path").attr("d",v).attr("class","feature state zoom-in").on("click",j),c.append("path").datum(topojson.mesh(b,b.objects.states,function(a,b){return a!==b})).attr("class","border").attr("d",v)}function n(a,b){if(Solidarity.log("drawCounties",b),a)return Solidarity.error(a,"error in drawCounties"),!1;for(var c in b.objects)break;var d=c.split(".")[0],e=t.map.append("g").attr("class","state").attr("id",d),f=topojson.feature(b,b.objects[c]).features;_.each(f,function(a){a.properties.type="county"});e.append("g").attr("class","counties").selectAll("path").attr("class","counties").style("fill",t.colorUnselected).data(f).enter().append("path").attr("d",v).attr("class","feature county zoom-in").on("click",k);e.selectAll("path.background").style("fill",t.colorBackground),e.append("path").datum(topojson.mesh(b,b.objects[c])).attr("class","border").style("border","white").attr("d",v),t.counties.fetch({data:{state_name:d},success:function(){t.renderStoryCollection(d,t.counties,"g.state path.county","g.country path.feature")}})}function o(a,b){if(a)return Solidarity.error(a,"error in loadZips"),!1;for(var c in b.objects)break;t.dataCache.zips[c]=b}function p(a){var b=d3.selectAll("g.state"),c=b[0][0].id,d=c+".geo",e=t.dataCache.zips[d],f=b.append("g").attr("class","zipcodes"),g=topojson.feature(e,e.objects[d]).features;_.each(g,function(a){a.properties.type="zip"}),f.selectAll("path").attr("class","zipcodes").style("fill",t.colorUnselected).data(g).enter().append("path").attr("d",v).attr("class","feature zipcode").on("click",l),f.append("path").datum(topojson.mesh(e,e.objects[d])).attr("class","border").attr("d",v),t.zipcodes.fetch({data:{state_name:c},success:function(){t.renderStoryCollection(c,t.zipcodes,"g.zipcodes path.zipcode","g.state path.county")}})}var q=960,r=500,s=d3.select(null),t=(d3.select(null),this);this.colorBackground="#3F3F3F",this.colorUnselected="#E4E4E4";var u=d3.geo.albersUsaPr().scale(1e3).translate([q/2,r/2]),v=d3.geo.path().projection(u);this.path=v,this.svg=d3.select("#map").append("svg").attr("preserveAspectRatio","xMinYMin meet").attr("viewBox","0 0 "+q+" "+r).classed("svg-content-responsive",!0).on("click",f,!0),this.svg.append("rect").attr("class","background").attr("width",q).attr("height",r).on("click",b),this.map=this.svg.append("g");var w=d3.behavior.zoom().translate([0,0]).scale(1).scaleExtent([1,256]).on("zoom",e);this.zoom=w;d3.selectAll("#zoom input").attr("value",w.scaleExtent()[0]).on("input",d);d3.selectAll("#zoom .btn").on("click",c),this.svg.call(w).call(w.event),void 0===this.us_states?d3.json(Solidarity.dataRoot+"geography/states.topo.json",function(a,b){Solidarity.log("requesting states.topo.json"),t.dataCache.us=b,m(a,t.dataCache.us)}):(Solidarity.log("using cached states.topo.json"),m(null,this.dataCache.us)),this.tip=d3.tip().html(g).direction(h).offset(i),this.svg.call(this.tip),d3.selectAll("#d3-tip").on("mouseout",this.tip.hide)},colorScale:function(a,b){var c=_.reject(_.pluck(a,b),_.isUndefined);if(0===c.length)return Solidarity.log("no data for "+b,a),d3.functor("#E4E4E4");for(var d=null,e=5;e>=1;e--){try{d=jenks(c,e)}catch(f){continue}if(d)break}return d?d3.scale.quantile().domain(d.slice(1)).range(this.colorList):(Solidarity.error("unable to determine jenks breaks",a,b),d3.functor("#E4E4E4"))},hoverGeometry:function(a){this.hoveredGeom=a},renderStoryCollection:function(a,b,c,d){var e=b.models.map(function(a){return a.attributes}),f=this.map.selectAll(c).data(),g=_.map(f,function(a,b){if(a.properties){var c;c=a.properties.name?_.findWhere(e,{name:a.properties.name}):_.findWhere(e,{zipcode:a.id}),c&&(a.properties.story_count=c.story_count)}return a}),h=_.pluck(g,"properties"),i=this.colorScale(h,"story_count"),j=this;this.map.selectAll(c).data(g).style("fill",function(a){return void 0===a.properties?j.colorUnselected:i(a.properties.story_count||0)}),d&&(d3.selectAll(d).style("fill",this.colorUnselected),d3.selectAll(d+".active").attr("class","background").style("fill",this.colorBackground)),this.map.selectAll(c).on("mouseover",function(a){d3.select(".hover").classed("hover",!1),d3.select(this).classed("hover",!0),j.tip.show(a)}).on("mouseout",function(a){var b=function(){j.tip.style("opacity")<1&&d3.select(this).classed("hover",!1)};setTimeout(_.bind(b,this),10),j.tip.hide(a)})}})}(),Solidarity.Views=Solidarity.Views||{},function(){Solidarity.Views.StoryPost=Solidarity.Views.FormView.extend({template:JST["app/templates/storyPost.html"],el:"#shareBar",form:"form#storyPost",events:{'click textarea[name="content"]':"show",'keyup textarea[name="content"].closed':"show","click button#geolocate":"geolocate","click button#cancel":"hide"},beenRendered:!1,isOpen:!1,initialize:function(){_.extend(this.events,Solidarity.Views.FormView.prototype.events),this.delegateEvents(this.events)},render:function(){return Solidarity.log("storyPost.render"),this.$el.hide().html(this.template()).slideDown(1e3),this.$form=$(this.form),this.beenRendered=!0,this},show:function(){Solidarity.log("storyPost.show"),this.isOpen||(Solidarity.mainContent.showOverlay(!0),$("#overlay").delay(500).addClass("active"),this.beenRendered?(this.$el.animate({height:"100%"},500),$("textarea",this.$el).delay(500).removeClass("closed").addClass("open")):this.render(),this.$el.removeClass("closed"),this.isOpen=!0,this.onShow())},hide:function(a){a.preventDefault(),this.$el.animate({height:"30px"},500).delay(500).addClass("closed"),$("textarea",this.$el).removeClass("open").addClass("closed"),this.isOpen=!1,Solidarity.mainContent.hideOverlay()},onShow:function(){this.$form=$(this.form),$(".selectpicker").selectpicker()},onSuccess:function(a){Solidarity.log("storyPosted",a);var b=Solidarity.siteRoot+"#read/story/"+a.id,c=b.split("//")[1];this.$el.html('<span class="icon icon-write"></span><textarea name="content" placeholder="SHARE YOUR STORY"></textarea>'),this.$el.addClass("closed"),this.isOpen=!1,this.beenRendered=!1,this.thanksView=new Solidarity.Views.StoryThanks,this.thanksView.render({url:b,link:c})},geolocate:function(){return Modernizr.geolocation?(Solidarity.log("geolocate!"),navigator.geolocation.getCurrentPosition(this.locationToCityState,this.geoError.bind(this)),$(".icon-locate").addClass("pulse"),void 0):this.geoError({code:0,message:"Your browser does not support geolocation."})},geoError:function(a){this.clearAlerts();var b="Geolocation error";1===a.code&&(b="Please allow the browser to access your location."),2===a.code&&(b="Geolocation position unavailable."),3===a.code&&(b="Geolocation position timeout."),this.$form.append(this.templateError({non_field_errors:b}))},locationToCityState:function(a){var b=this;$.ajax("https://search.mapzen.com/v1/reverse",{type:"GET",data:{"point.lat":a.coords.latitude,"point.lon":a.coords.longitude,layers:"address",size:1,api_key:Solidarity.mapzenKey},success:function(a){var b=a.features[0];$("input#city").val(b.properties.locality),$("input#county").val(b.properties.county),$("select#state").selectpicker("val",b.properties.region_a),$("button#geolocate").attr("disabled","disabled"),$(".icon-locate").removeClass("pulse")},error:function(a,c,d){return b.geoError({code:4,message:d})}})}})}(),Solidarity.Views=Solidarity.Views||{},function(){Solidarity.Views.SearchBar=Solidarity.Views.BaseView.extend({el:"#searchBar",template:JST["app/templates/storySearch.html"],events:{'keyup input[name="search"]':"search","click .result a":"close","click .close":"close"},render:function(a){return this.$el.html(this.template(a)),this},search:_.debounce(function(){var a=$('input[name="search"]').val().trim();if(""!==a){var b=this;$.ajax({url:Solidarity.apiRoot+"search/",data:{content:a},success:function(c){b.render({search:a,count:c.count,results:c.results}),$('input[name="search"]').click()}})}},500),close:function(){return this.render({})}})}(),Solidarity.Views=Solidarity.Views||{},function(){Solidarity.Views.AuthLogin=Solidarity.Views.FormView.extend({form:"form#login",template:JST["app/templates/authLogin.html"],onSuccess:function(a){return a.key&&$.cookie("token",a.key),this.redirect()}}),Solidarity.Views.AuthRegister=Solidarity.Views.FormView.extend({form:"form#register",template:JST["app/templates/authRegister.html"]}),Solidarity.Views.AuthPasswordChange=Solidarity.Views.FormView.extend({form:"form#passwordChange",template:JST["app/templates/authPasswordChange.html"]}),Solidarity.Views.AuthPasswordReset=Solidarity.Views.FormView.extend({form:"form#passwordReset",template:JST["app/templates/authPasswordReset.html"]}),Solidarity.Views.AuthPasswordResetConfirm=Solidarity.Views.FormView.extend({form:"form#passwordResetConfirm",template:JST["app/templates/authPasswordResetConfirm.html"]}),Solidarity.Views.AuthUserDetails=Solidarity.Views.FormView.extend({form:"form#userDetails",template:JST["app/templates/authUserDetails.html"]})}(),Solidarity.Views=Solidarity.Views||{},function(){Solidarity.Views.Page=Solidarity.Views.BaseView.extend({el:"#content",initialize:function(a){this.template=JST[a],this.render()},render:function(){return this.$el.html(this.template()),this}})}(),Solidarity.Views=Solidarity.Views||{},function(){Solidarity.Views.StoryThanks=Solidarity.Views.BaseView.extend({template:JST["app/templates/storyThanks.html"],el:"#overlay",events:{"click .copyLink":"copyLink","click .close":"close"},initialize:function(){},render:function(a){this.$el.html(this.template(a))},copyLink:function(a){$(".copyLink").selectText()},close:function(){Solidarity.mainContent.hideOverlay()}})}(),Solidarity.Views=Solidarity.Views||{},function(){Solidarity.Views.Splash=Solidarity.Views.BaseView.extend({template:JST["app/templates/splash.html"],el:"#content",events:{"click button.enter":"enter","click button.lang":"clickLanguage"},languages:["zh","en","es","tl"],langIndex:0,rotateLanguageTimer:void 0,render:function(){this.$el.html(this.template());var a=this;return $(".splash").bgswitcher({images:[Solidarity.siteRoot+"images/splash/48a31254.splash-1.jpg",Solidarity.siteRoot+"images/splash/2277d472.splash-2.jpg",Solidarity.siteRoot+"images/splash/e3260293.splash-3.jpg",Solidarity.siteRoot+"images/splash/03592ba4.splash-4.jpg",Solidarity.siteRoot+"images/splash/fd4f24e9.splash-5.jpg",Solidarity.siteRoot+"images/splash/e9460c9d.splash-6.jpg",Solidarity.siteRoot+"images/splash/51540844.splash-7.jpg"],shuffle:!0,loop:!0,start:!1,interval:1e4,effect:"fade"}),$.when($("ul.statement").animate({top:0},1e3).promise(),$("ul.languages li").eq(0).delay(500).animate({top:"0px",opacity:1},1e3).promise(),$("ul.languages li").eq(1).delay(1e3).animate({top:"0px",opacity:1},1e3).promise(),$("ul.languages li").eq(2).delay(1500).animate({top:"0px",opacity:1},1e3).promise(),$("ul.languages li").eq(3).delay(2e3).animate({top:"0px",opacity:1},1e3).promise()).done(function(){Solidarity.log("Splash load complete."),a.rotateLanguageTimer=setInterval(a.rotateLanguage.bind(a),2500),$(".splash").bgswitcher("start")}),this},rotateLanguage:function(){this.langIndex+=1,this.langIndex===this.languages.length&&(this.langIndex=0);var a=this.languages[this.langIndex],b=$("ul.languages .btn[data-lang="+a+"]");return this.changeLanguage(b)},changeLanguage:function(a){var b=a.data("lang");$("ul.languages .btn.active").removeClass("active"),$("ul.statement li").fadeOut(500),$("ul.statement li#"+b).fadeIn(500),a.addClass("active")},clickLanguage:function(a){var b=$(a.target),c=b;return c.is("span")&&(c=b.parents("button")),clearInterval(this.rotateLanguageTimer),this.changeLanguage(c)},rotateImage:function(){this.imageIndex+=1,this.imageIndex===this.images.length&&(this.imageIndex=0),$("div.splash").css("background-image","url("+this.images[this.imageIndex]+")")},enter:function(){$("nav.navbar-default").removeClass("hidden"),$("footer.footer").removeClass("hidden"),Solidarity.language=this.languages[this.currentLanguageID],Backbone.history.navigate("#map",{trigger:!0})}})}(),Solidarity.Views=Solidarity.Views||{},function(){Solidarity.Views.Index=Solidarity.Views.BaseView.extend({template:JST["app/templates/index.html"],el:"#content",events:{},render:function(){return this.$el.html(this.template()),this}})}(),Solidarity.Routers=Solidarity.Routers||{},function(){Solidarity.Routers.Base=Backbone.Router.extend({options:{trailingSlashIsSignificant:!0},_routeToRegExp:function(a){return a=Backbone.Router.prototype._routeToRegExp.call(this,a),new RegExp(a.source,"i")},initialize:function(){this.bind("route",this.pageView)},pageView:function(){var a=Backbone.history.getFragment();if(/^\//.test(a)||""===a||(a="/"+a),"undefined"!=typeof window._gaq&&_gaq.push(["_trackPageview",a]),"undefined"!=typeof window.GoogleAnalyticsObject){var b=window.GoogleAnalyticsObject;window[b]("send","pageview",a)}}})}(),Solidarity.Routers=Solidarity.Routers||{},function(){Solidarity.Routers.Auth=Solidarity.Routers.Base.extend({routes:{"auth/register":"register","auth/login":"login","auth/logout":"logout","auth/password/change":"passwordChange","auth/password/reset":"passwordReset","auth/password/reset/confirm":"passwordResetConfirm","auth/user":"userDetails"},register:function(){Solidarity.mainContent.show(new Solidarity.Views.AuthRegister({el:"#content"}))},login:function(){Solidarity.mainContent.show(new Solidarity.Views.AuthLogin({el:"#content"}))},logout:function(){Solidarity.mainContent.show(new Solidarity.Views.AuthLogout({el:"#content"}))},passwordChange:function(){Solidarity.mainContent.show(new Solidarity.Views.AuthPasswordChange({el:"#content"}))},passwordReset:function(){Solidarity.mainContent.show(new Solidarity.Views.AuthPasswordReset({el:"#content"}))},passwordResetConfirm:function(){Solidarity.mainContent.show(new Solidarity.Views.AuthPasswordResetConfirm({el:"#content"}))},userDetails:function(){Solidarity.mainContent.show(new Solidarity.Views.AuthUserDetails({el:"#content"}))}})}(),Solidarity.Routers=Solidarity.Routers||{},function(){Solidarity.Routers.Pages=Solidarity.Routers.Base.extend({routes:{"":"index",learn:"learn",splash:"splash",about:"about",privacy:"privacy",copyright:"copyright",admin:"adminRedirect"},index:function(){Solidarity.mainContent.freshView()?Backbone.history.navigate("splash",{trigger:!0}):Backbone.history.navigate("map",{trigger:!0})},splash:function(){Solidarity.mainContent.show(new Solidarity.Views.Splash({}))},learn:function(){Solidarity.mainContent.show(new Solidarity.Views.Page("app/templates/learn.html"),"#learn")},about:function(){Solidarity.mainContent.show(new Solidarity.Views.Page("app/templates/about.html"),null,"#about")},privacy:function(){Solidarity.mainContent.show(new Solidarity.Views.Page("app/templates/privacy.html"),null,"#privacy")},copyright:function(){Solidarity.mainContent.show(new Solidarity.Views.Page("app/templates/copyright.html"),null,"#contact")},adminRedirect:function(){window.location.href="https://stories-of-solidarity.herokuapp.com/admin/"}})}(),Solidarity.Routers=Solidarity.Routers||{},function(){Solidarity.Routers.Stories=Solidarity.Routers.Base.extend({routes:{map:"storyMap",read:"storyList","read/story/:id":"storyView","view/:state_name":"storyListLocation","view/:state_name/:location":"storyListLocation"},cached:{storyListLocation:{}},storyMap:function(){void 0===this.cached.storyMap&&(this.cached.storyMap=new Solidarity.Views.StoryMap),Solidarity.mainContent.show(this.cached.storyMap,"#map")},storyList:function(){void 0===this.cached.storyList&&(this.cached.storyList=new Solidarity.Views.StoryList),Solidarity.mainContent.show(this.cached.storyList,"#read")},storyListLocation:function(a,b){var c=a;b&&(c+=":"+b),void 0===this.cached.storyListLocation[c]&&(this.cached.storyListLocation[c]=new Solidarity.Views.StoryListLocation({state_name:a,location:b})),Solidarity.mainContent.show(this.cached.storyListLocation[c],"#read")},storyView:function(a){Solidarity.mainContent.show(new Solidarity.Views.Story({model:new Solidarity.Models.Story({id:a})}),"#read")}})}();